# SAP_LLM Default Configuration
# Environment: development

system:
  name: "SAP_LLM"
  version: "1.0.0"
  environment: "development"
  debug: true
  log_level: "INFO"

# Model configurations
models:
  # Vision Encoder (LayoutLMv3)
  vision_encoder:
    name: "microsoft/layoutlmv3-base"
    path: "/models/vision_encoder"
    parameters: 300_000_000
    device: "cuda"
    precision: "fp16"
    batch_size: 4
    max_image_size: 1024

  # Language Decoder (LLaMA-2-7B)
  language_decoder:
    name: "meta-llama/Llama-2-7b-hf"
    path: "/models/language_decoder"
    parameters: 7_000_000_000
    device: "cuda"
    precision: "int8"  # Quantized
    batch_size: 2
    max_length: 2048

  # Reasoning Engine (Mixtral-8x7B)
  reasoning_engine:
    name: "mistralai/Mixtral-8x7B-v0.1"
    path: "/models/reasoning_engine"
    parameters: 47_000_000_000
    active_experts: 2
    device: "cuda"
    precision: "int8"
    batch_size: 1
    max_length: 4096

  # Unified SAP_LLM
  unified_model:
    path: "/models/sap_llm_unified"
    total_parameters: 13_800_000_000
    checkpoint_interval: 500
    save_best_only: true

# Training configuration
training:
  # Data
  data_dir: "/data"
  train_split: 0.7
  val_split: 0.15
  test_split: 0.15
  num_workers: 8

  # Hyperparameters
  learning_rate: 5.0e-5
  warmup_steps: 1000
  max_steps: 50000
  gradient_accumulation_steps: 8
  mixed_precision: "fp16"

  # Optimization
  optimizer: "adamw"
  weight_decay: 0.01
  max_grad_norm: 1.0

  # Distributed training
  distributed: true
  world_size: 4
  backend: "nccl"

  # Checkpointing
  checkpoint_dir: "/models/checkpoints"
  save_steps: 500
  eval_steps: 100
  logging_steps: 10

# Pipeline stages configuration
stages:
  # Stage 1: Inbox
  inbox:
    enabled: true
    model_size: "50M"
    thumbnail_size: 256
    max_tokens: 128
    confidence_threshold: 0.95

  # Stage 2: Preprocessing
  preprocessing:
    enabled: true
    ocr_engine: "easyocr"  # Options: tesseract, easyocr, custom
    target_dpi: 300
    languages: ["en", "de", "fr", "es", "it"]
    deskew: true
    denoise: true
    binarize: true

  # Stage 3: Classification
  classification:
    enabled: true
    num_classes: 62
    confidence_threshold: 0.90
    use_ensemble: false

  # Stage 4: Type Identifier
  type_identifier:
    enabled: true
    hierarchical: true
    num_subtypes: 198
    confidence_threshold: 0.85

  # Stage 5: Extraction
  extraction:
    enabled: true
    schema_validation: true
    constrained_decoding: true
    max_fields: 180
    field_confidence_threshold: 0.80

  # Stage 6: Quality Check
  quality_check:
    enabled: true
    overall_threshold: 0.90
    self_correction_enabled: true
    max_correction_attempts: 3

  # Stage 7: Validation
  validation:
    enabled: true
    business_rules_enabled: true
    pmg_lookup_enabled: true
    tolerance_checking: true

  # Stage 8: Routing
  routing:
    enabled: true
    reasoning_enabled: true
    pmg_context_enabled: true
    confidence_threshold: 0.85

# SAP Knowledge Base
knowledge_base:
  sap_api_count: 400
  vector_store:
    type: "faiss"
    dimension: 384
    index_type: "IndexFlatL2"
    embedding_model: "all-MiniLM-L6-v2"

  field_mappings_path: "/data/schemas/field_mappings"
  business_rules_path: "/data/schemas/business_rules"
  transformation_functions_path: "/data/schemas/transformations"

# Process Memory Graph (PMG)
pmg:
  enabled: true
  backend: "cosmos_gremlin"  # Options: cosmos_gremlin, neo4j

  # Cosmos DB settings
  cosmos:
    endpoint: "${COSMOS_ENDPOINT}"
    key: "${COSMOS_KEY}"
    database: "qorsync"
    container: "pmg"

  # Neo4j settings (alternative)
  neo4j:
    uri: "bolt://localhost:7687"
    username: "neo4j"
    password: "${NEO4J_PASSWORD}"

  # Graph configuration
  max_similar_docs: 20
  similarity_threshold: 0.85
  embedding_dimension: 768

  # Learning
  continuous_learning:
    enabled: true
    batch_size: 100
    retraining_interval: "daily"
    drift_threshold: 0.25

# APOP (Agentic Process Orchestration Protocol)
apop:
  enabled: true
  spec_version: "1.0"

  # CloudEvents compliance
  source: "sap_llm"
  content_type: "application/json"

  # Signature
  signing_enabled: true
  algorithm: "ECDSA"
  private_key_path: "/keys/apop_private_key.pem"

  # Service Bus
  service_bus:
    connection_string: "${SERVICE_BUS_CONNECTION_STRING}"
    namespace: "qorsync"

  # Agents
  agents:
    - name: "inbox"
      topic: "qorsync.inbox"
      subscription: "inbox-sub"
    - name: "preprocessor"
      topic: "qorsync.preprocessor"
      subscription: "preprocessor-sub"
    - name: "classifier"
      topic: "qorsync.classifier"
      subscription: "classifier-sub"
    - name: "extractor"
      topic: "qorsync.extractor"
      subscription: "extractor-sub"
    - name: "quality_checker"
      topic: "qorsync.quality_checker"
      subscription: "quality_checker-sub"
    - name: "validator"
      topic: "qorsync.validator"
      subscription: "validator-sub"
    - name: "router"
      topic: "qorsync.router"
      subscription: "router-sub"

# Self-Healing Workflow Loop (SHWL)
shwl:
  enabled: true

  # Exception clustering
  clustering:
    algorithm: "hdbscan"
    min_cluster_size: 15
    metric: "cosine"
    epsilon: 0.3

  # Rule generation
  rule_generation:
    enabled: true
    reasoning_model: "reasoning_engine"
    confidence_threshold: 0.90

  # Approval workflow
  approval:
    enabled: true
    auto_approve_threshold: 0.95
    human_review_required: true

  # Scheduling
  schedule:
    frequency: "daily"
    time: "02:00"
    lookback_days: 7

# Databases
databases:
  # Redis (caching)
  redis:
    host: "${REDIS_HOST:-localhost}"
    port: 6379
    db: 0
    password: "${REDIS_PASSWORD}"
    ttl: 3600
    max_connections: 50

  # MongoDB (document storage)
  mongodb:
    uri: "${MONGODB_URI:-mongodb://localhost:27017}"
    database: "sap_llm"
    collections:
      documents: "documents"
      results: "results"
      exceptions: "exceptions"

# API Server
api:
  host: "${API_HOST:-0.0.0.0}"
  port: ${API_PORT:-8000}
  workers: ${API_WORKERS:-4}
  reload: false

  # CORS
  cors:
    enabled: true
    origins:
      - "${API_CORS_ORIGINS:-http://localhost:3000}"
    credentials: ${API_CORS_CREDENTIALS:-true}
    methods: ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
    headers: ["*"]

  # Rate limiting
  rate_limit:
    enabled: true
    requests_per_minute: 100

  # Authentication
  auth:
    enabled: true
    type: "bearer"  # Options: bearer, api_key, oauth2
    secret_key: "${API_SECRET_KEY}"

# Performance
performance:
  # Caching
  cache:
    enabled: true
    levels: ["l1_memory", "l2_redis", "l3_cosmos"]
    l1_max_size: 1000
    l2_ttl: 3600
    l3_ttl: 86400

  # Batching
  batching:
    enabled: true
    max_batch_size: 8
    batch_timeout_ms: 100

  # Optimization
  optimization:
    quantization: "int8"
    onnx_enabled: false
    compile_model: false

# Monitoring
monitoring:
  enabled: true

  # Prometheus
  prometheus:
    enabled: true
    port: 9090
    path: "/metrics"

  # OpenTelemetry
  opentelemetry:
    enabled: false
    endpoint: "${OTEL_ENDPOINT}"

  # Logging
  logging:
    level: "INFO"
    format: "json"
    output: "stdout"
    file_path: "/logs/sap_llm.log"

# Testing
testing:
  test_data_path: "/data/test_set"
  benchmark_path: "/data/benchmarks"

  # Metrics thresholds
  thresholds:
    classification_accuracy: 0.95
    extraction_f1: 0.92
    latency_p95_ms: 1500
    schema_compliance: 0.99
    cost_per_document: 0.005

# Document types - Comprehensive SAP business documents
document_types:
  # Procurement & Supply Chain
  - PURCHASE_REQUISITION
  - PURCHASE_ORDER
  - PURCHASE_ORDER_CONFIRMATION
  - PURCHASE_ORDER_CHANGE
  - GOODS_RECEIPT
  - GOODS_ISSUE
  - INBOUND_DELIVERY
  - OUTBOUND_DELIVERY
  - ADVANCED_SHIPPING_NOTICE
  - DESPATCH_ADVICE
  - SHIPMENT_NOTIFICATION
  - DELIVERY_SCHEDULE
  - MATERIAL_MASTER
  - VENDOR_MASTER

  # Sales & Distribution
  - SALES_INQUIRY
  - SALES_QUOTATION
  - SALES_ORDER
  - SALES_ORDER_CONFIRMATION
  - DELIVERY_NOTE
  - PACKING_LIST
  - BILLING_DOCUMENT
  - CUSTOMER_INVOICE
  - PRO_FORMA_INVOICE
  - CREDIT_NOTE
  - DEBIT_NOTE
  - CREDIT_MEMO_REQUEST
  - DEBIT_MEMO_REQUEST
  - RETURNS
  - COMPLAINT

  # Finance & Accounting
  - SUPPLIER_INVOICE
  - PAYMENT_ADVICE
  - REMITTANCE_ADVICE
  - STATEMENT_OF_ACCOUNT
  - BANK_STATEMENT
  - FINANCIAL_DOCUMENT
  - ACCOUNTING_DOCUMENT
  - PAYMENT_ORDER
  - DUNNING_NOTICE

  # Contracts & Agreements
  - CONTRACT
  - QUOTE
  - SCHEDULING_AGREEMENT
  - OUTLINE_AGREEMENT
  - SERVICE_ENTRY_SHEET

  # Other Business Documents
  - INVENTORY_DOCUMENT
  - STOCK_TRANSFER_ORDER
  - PHYSICAL_INVENTORY
  - QUALITY_NOTIFICATION
  - SERVICE_ORDER
  - PRODUCTION_ORDER
  - TIME_SHEET
  - EXPENSE_REPORT
  - OTHER

# Supported languages
languages:
  - en  # English
  - de  # German
  - fr  # French
  - es  # Spanish
  - it  # Italian
  - pt  # Portuguese
  - nl  # Dutch
  - pl  # Polish
  - cs  # Czech
  - hu  # Hungarian

# Web Search Configuration
web_search:
  enabled: true
  offline_mode: false  # Set true to disable all internet connectivity
  cache_enabled: true

  # Search Providers
  providers:
    # Google Custom Search API
    google:
      enabled: false
      api_key: "${GOOGLE_SEARCH_API_KEY}"
      cx: "${GOOGLE_SEARCH_CX}"  # Custom Search Engine ID

    # Bing Search API
    bing:
      enabled: false
      api_key: "${BING_SEARCH_API_KEY}"

    # Tavily AI Search (AI-optimized)
    tavily:
      enabled: false
      api_key: "${TAVILY_API_KEY}"

    # DuckDuckGo (no API key - fallback)
    duckduckgo:
      enabled: true  # Always available as fallback

  # Provider Priority (order to try)
  provider_priority:
    - tavily     # Try Tavily first (AI-optimized)
    - google     # Then Google
    - bing       # Then Bing
    - duckduckgo # Finally DuckDuckGo (free fallback)

  # Rate Limits (requests per minute / per day)
  rate_limits:
    google: 100
    google_daily: 10000
    bing: 100
    bing_daily: 10000
    tavily: 60
    tavily_daily: 1000
    duckduckgo: 30
    duckduckgo_daily: 1000

  # Caching Configuration (3-tier: L1=memory, L2=Redis, L3=disk)
  cache:
    # L2: Redis cache
    host: "${REDIS_HOST:-localhost}"
    port: 6379
    db: 1  # Separate DB from main cache
    password: "${REDIS_PASSWORD}"
    ttl: 86400  # Cache results for 24 hours (default)
    compress_threshold: 1024  # Compress results > 1KB

    # L3: Disk cache (persistent fallback)
    disk_cache_dir: "/tmp/sap_llm_search_cache"
    max_disk_cache_size_mb: 1000  # Max 1GB disk cache

    # TTL Strategy (in seconds)
    ttl_vendor_info: 604800     # 7 days
    ttl_product_codes: 2592000  # 30 days
    ttl_tax_rates: 86400        # 1 day
    ttl_exchange_rates: 3600    # 1 hour

  # Trusted Domains (boosted in ranking)
  trusted_domains:
    - sap.com
    - help.sap.com
    - api.sap.com
    - developers.sap.com
    - community.sap.com
    - support.sap.com
    - wikipedia.org
    - github.com
    - stackoverflow.com
    - microsoft.com

  # Blocked Domains (filtered out)
  blocked_domains:
    - example.com
    - spam.com
    - ads.com

  # Result Processing
  min_relevance_score: 0.3  # Minimum score to include result

  # Feature Flags
  features:
    vendor_verification: true
    address_validation: true
    tax_id_validation: true
    price_validation: true
    exchange_rates: true
    sap_doc_search: true
    knowledge_base_updates: true

  # Integration with Pipeline Stages
  integrations:
    # Validation stage
    validation:
      enabled: true
      verify_vendors: true
      verify_addresses: true
      verify_tax_ids: true
      verify_bank_details: true

    # Routing stage
    routing:
      enabled: true
      api_discovery: true
      endpoint_lookup: true

    # Quality check stage
    quality_check:
      enabled: true
      fact_verification: true
      cross_reference: true
      price_validation: true

    # Knowledge base
    knowledge_base:
      enabled: true
      auto_update: false  # Set true for automatic updates
      update_schedule: "weekly"
